FROM nginx:latest

# Create a non-root user
RUN groupadd -r radoslv && useradd -r -g radoslv radoslv

# Install sudo
RUN apt-get update && apt-get install -y sudo && rm -rf /var/lib/apt/lists/*

# Add the non-root user to the sudo group
RUN usermod -aG sudo radoslv

# Allow passwordless sudo for the user
RUN echo "radoslv ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/radoslv

# Create a directory and set permissions
RUN mkdir /app && chown -R radoslv /app

# Switch to the non-root user
USER radoslv

# Set the working directory
WORKDIR /app

# Copy configuration
COPY ./nginx-golang-mysql/proxy/nginx.conf /etc/nginx/conf.d/default.conf

# Expose port
EXPOSE 80

# Start Nginx with sudo
CMD ["sudo", "nginx", "-g", "daemon off;"]